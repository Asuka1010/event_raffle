{% extends 'raffle/base.html' %}
{% block title %}{{ run.name }}{% endblock %}
{% block content %}
<div class="header">
  <h1>{{ run.name }}</h1>
  <p>Date: {{ run.date|default:'—' }} • Capacity: {{ run.capacity }}</p>
</div>

<div class="button-container" style="margin-bottom: 12px;">
  <a class="btn btn-secondary" href="{% url 'raffle:upload' %}">Home</a>
  <a class="btn btn-primary" href="{% url 'raffle:config' %}">New event</a>
  </div>

<div class="card">
  <div class="card-header"><h3>Selected Students</h3></div>
  <div class="card-content">
    <form method="post">
      {% csrf_token %}
      <div class="table-container">
        <table>
          <thead>
            <tr><th>Name</th><th>Email</th><th>Class</th><th>Absent</th><th>Late</th></tr>
          </thead>
          <tbody>
            {% for s in selected_rows %}
            <tr>
              <td>{{ s.name }}</td>
              <td>{{ s.email }}</td>
              <td>{{ s.class }}</td>
              <td><input type="checkbox" name="absent_{{ s.email }}"></td>
              <td><input type="checkbox" name="late_{{ s.email }}"></td>
            </tr>
            {% empty %}<tr><td colspan="5">No data.</td></tr>{% endfor %}
          </tbody>
        </table>
      </div>
      <div class="button-container" style="margin-top: 12px;">
        <button class="btn btn-primary" type="submit">Save attendance</button>
      </div>
    </form>
  </div>
</div>

<div class="card">
  <div class="card-header"><h3>All Eligible (Ranked)</h3></div>
  <div class="card-content">
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Rank</th><th>Name</th><th>Email</th><th>Class</th>
            <th>Attended</th><th>Absences</th><th>Late</th><th>Latest</th><th>Selected</th>
          </tr>
        </thead>
        <tbody>
          {% for s in eligible_rows %}
          <tr>
            <td>{{ s.rank }}</td>
            <td>{{ s.name }}</td>
            <td>{{ s.email }}</td>
            <td>{{ s.class }}</td>
            <td>{{ s.num_events_attended }}</td>
            <td>{{ s.num_absences }}</td>
            <td>{{ s.num_late_arrivals }}</td>
            <td>{{ s.latest_attended }}</td>
            <td>{{ s.selected }}</td>
          </tr>
          {% empty %}<tr><td colspan="9">No data.</td></tr>{% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}


